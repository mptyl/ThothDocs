# Installazione assistita su Docker con install.sh

**ThothAI** fornisce uno script di installazione unificato `install.sh` che semplifica notevolmente il processo di installazione e configurazione del sistema completo.

!!! success "Installazione Automatizzata"
    
    Lo script `install.sh` rappresenta il metodo più semplice e veloce per installare ThothAI, gestendo automaticamente la configurazione, la generazione dei file di ambiente e l'avvio dei servizi Docker.

## Prerequisiti

Prima di utilizzare lo script di installazione, assicurarsi di avere:

- **Python 3.13++** installato nel sistema
- **Docker** e **Docker Compose** installati e funzionanti
- **File di configurazione**: `config.yml.local` creato e configurato con le API keys necessarie

## 1. Prima Installazione

### 1.1 Preparazione della Configurazione

**Attività obbligatoria**: Creare il file `config.yml.local` prima di eseguire `install.sh`:

Vedere i dettagli [in questa pagina del capitolo di preparazione all'installazione](../1-install/1.1-sources_cloning.md#preparazione-configurazione)
```bash
cp config.yml config.yml.local
```

**Conseguenze della mancata configurazione**:

- Lo script termina immediatamente con errore
- Richiede configurazione di API keys per i servizi AI
- Richiede configurazione del provider di embedding
- Richiede impostazione preferenze database e porte dei servizi

### 1.2 Esecuzione Base

```bash
./install.sh
```

**Cosa fa automaticamente**:

- Verifica tutti i prerequisiti di sistema
- Installa pacchetti Python necessari (pyyaml, requests, toml, ecc.)
- Valida la configurazione fornita
- Configura le dipendenze per il servizio di embedding
- Avvia l'installer interattivo per la selezione dei database
- Esegue il deploy automatico dei container Docker

## 2. Opzioni di Configurazione Avanzate

### 2.1 Opzione di Pulizia Cache Build (`--clean-cache`)

```bash
./install.sh --clean-cache
```

**Quando usare**:

- Dopo modifiche al Dockerfile
- Quando si verificano errori di build inconsistenti
- Per liberare spazio disco dalla cache Docker

**Conseguenze**:

- Aumenta il tempo di build alla successiva esecuzione
- Risolve problemi di cache corrotta
- Non influisce sui dati dell'applicazione

### 2.2 Opzione di Pulizia Completa Risorse (`--prune-all`)

```bash
./install.sh --prune-all
```

**Quando usare**:

- Per fare un reset completo dell'ambiente Docker
- Prima di una reinstallazione da zero in cui si vuole essere sicuri di non avere residui di versioni precedenti
- Per liberare spazio disco significativo
- Quando si verificano conflitti tra versioni

**Conseguenze**:

- **DISTRUGGE TUTTI I DATI** nei volumi Docker
- Rimuove tutti i container, immagini, volumi e reti ThothAI
- Richiede riconfigurazione completa
- Necessaria conferma esplicita (salvo che venga lanciata con `--force`)

#### Opzioni di sicurezza per `--prune-all`:

**Modalità preview** (`--dry-run`):
```bash
./install.sh --prune-all --dry-run
```
- Mostra cosa verrebbe eliminato senza rimuoverlo
- Utile per verificare l'impatto prima dell'operazione

**Esecuzione forzata** (`--force`):
```bash
./install.sh --prune-all --force
```
- Salta la richiesta di conferma
- Utile per script automatizzati

## 3. Manutenzione e Aggiornamenti

### 3.1 Aggiornamenti di Release

Quando si aggiorna ThothAI a una nuova versione:

```bash
# Opzione 1: Aggiornamento standard (raccomandato)
./install.sh

# Opzione 2: Aggiornamento con pulizia cache (per evitare potenziali problemi di build)
./install.sh --clean-cache
```

**Processo automatico**:

- Rileva modifiche alla configurazione
- Rigenera file di ambiente se necessario
- Ricostruisce container con nuove versioni
- Preserva dati esistenti nei volumi

### 3.2 Risoluzione Problemi

**Per problemi di prestazioni o comportamenti anomali**:
```bash
./install.sh --clean-cache
```

**Per problemi gravi o corruzioni**:
```bash
./install.sh --prune-all  # ATTENZIONE: distrugge i dati. Fare export dei csv di configurazioni e vettori prima
```

**Per verificare impatto prima di pulizia**:
```bash
./install.sh --prune-all --dry-run
```

## 4. Sistema di Configurazione

### 4.1 File di Configurazione Richiesti

**config.yml.local** (obbligatorio):

- API keys per almeno un servizio AI (OpenAI, Anthropic, OpenRouter, etc.)
- Configurazione provider di embedding
- Preferenze database SQL
- Porte dei servizi (se diverse dai default)
- Credenziali amministratore

**Conseguenze scelte database**:
- **PostgreSQL/MySQL/MariaDB**: Massima compatibilità, prestazioni ottimali
- **SQL Server**: Supporto enterprise, richiede licenza
- **SQLite**: Semplice, adatto a piccoli deployment (sempre incluso)

## 5. Flusso Operativo Completo

### Prima Installazione:

**Linux/macOS**:

1. Creare `config.yml.local` con API keys
2. Eseguire `./install.sh`
3. Attendere completamento deploy
4. Autenticarsi per accedere a una delle interfacce web
5. Selezionare un workspace
6. Verificare esecuzione delle funzionalità

**Windows (PowerShell)**:

1. Creare `config.yml.local` con API keys
2. Eseguire `.\install.ps1`
3. Attendere completamento deploy
4. Autenticarsi per accedere a una delle interfacce web
5. Selezionare un workspace
6. Verificare esecuzione delle funzionalità

**Windows (CMD)**:

1. Creare `config.yml.local` con API keys
2. Eseguire `install.bat`
3. Attendere completamento deploy
4. Autenticarsi per accedere a una delle interfacce web
5. Selezionare un workspace
6. Verificare esecuzione delle funzionalità

### Aggiornamenti Successivi:

1. Aggiornare codice sorgente
2. Modificare `config.yml.local` se necessario
3. Eseguire script appropriato per il sistema:
   - Linux/macOS: `./install.sh` (o con `--clean-cache`)
   - Windows PowerShell: `.\install.ps1` (o con `--clean-cache`)
   - Windows CMD: `install.bat` (o con `--clean-cache`)
4. Sistema rileva automaticamente le modifiche

### Reset Completo:

1. Backup dati importanti (se necessario)
2. Verificare impatto:
   - Linux/macOS: `./install.sh --prune-all --dry-run`
   - Windows PowerShell: `.\install.ps1 --prune-all --dry-run`
   - Windows CMD: `install.bat --prune-all --dry-run`
3. Eseguire pulizia:
   - Linux/macOS: `./install.sh --prune-all` (con conferma)
   - Windows PowerShell: `.\install.ps1 --prune-all` (con conferma)
   - Windows CMD: `install.bat --prune-all` (con conferma)
4. Ricominciare da prima installazione

## 6. Gestione Errori e Troubleshooting

**Configurazione mancante**:

- Errore immediato con istruzioni per creare `config.yml.local`

**Prerequisiti mancanti**:

- Verifica automatica di Python 3.13+, Docker, Docker Compose
- Messaggi chiari con link per installazione

**Errori di validazione**:

- Analisi automatica della configurazione
- Messaggi specifici sugli errori da correggere

**Problemi di embedding**:

- Configurazione critica per il funzionamento
- Errore bloccante se non configurato correttamente

!!! tip "Raccomandazioni"
    
    - **Prima installazione**: Seguire il flusso standard senza opzioni aggiuntive
    - **Aggiornamenti**: Usare `./install.sh` semplice per preservare configurazione
    - **Problemi**: Provare prima `--clean-cache`, poi `--prune-all` se necessario
    - **Produzione**: Usare sempre `--dry-run` prima di operazioni distruttive

!!! warning "Attenzione alle operazioni distruttive"
    
    L'opzione `--prune-all` **distrugge irreversibilmente tutti i dati**. Utilizzare solo quando necessario e sempre con backup preventivo.