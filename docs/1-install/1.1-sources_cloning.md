# Installazione di ThothAI - acquisizione dei sorgenti
**ThothAI** può essere installato sia come container `Docker`, per poter lavorare in un ambiente di produzione isolato e facilmente gestibile, 
sia in locale, per operare in un contesto `'development'` che permetta agevolmente di realizzare e testare eventuali personalizzazioni.

L'unico prerequisito è la disponibilità di `Python 3.13` o superiore.

!!! note "Installazione di Python"

    Le procedure di installazione di Python sono al di fuori dello scope di questo documento.
    Andare sul sito di [Python](https://www.python.org/) per acquisire le informazioni necessarie installare o aggiornare Python, se non è già stato fatto.

L'attività di installazione di **ThothAI** richiede un minimo di lavoro, non solo per il delivery fisico, ma anche per una configurazione di base. È stato fatto un certo sforzo
per semplificare il tutto il più possibile, ma trattandosi di un'applicazione abbastanza articolata, un certo sforzo rimane indispensabile.

!!! note "Perché non abbiamo reso disponibili le immagini Docker"

    Vi sono tre motivi per cui non abbiamo ancora reso disponibili direttamente le immagini docker di Thoth e di ThothSL:

    1. perché per poter effettuare il run dell'immagine sarebbe comunque necessario fornire parametri di di environment. I template di queste variabili sono disponibili nei sorgenti scaricabili da GitHub. Una fase di copia/incolla o di download di un file da GitHub sarebbe quindi comunque necessaria; 
    2. perchè per installare i default di configurazione indispensabili per un rapido utilizzo dell'applicazione, sono previsti dei 'bind' tra docker e il file system del sistema host, che è più semplice gestire partendo dai sorgenti;
    2. perchè in alcuni contesti, sfruttando la documentazione tecnica inclusa nei sorgenti, si vorrà personalizzare ulteriormente l'applicazione. Per cui la disponibilità dei sorgenti, che sono sotto licenza Apache 2.0, molto permissiva, sono un invito a customizzare e, se possibile, a contribuire allo sviluppo del progetto ThothAI.

## 1 - Attività preliminare - clonazione dei progetti da GitHub
Prima di tutto occorre clonare da GitHub i repository del backend (**Thoth**) e del frontend (**ThothUI**). 

Da linea di comando posizionarsi dove si preferisce, creare una directory, ad esempio ThothAI, ed entrarci:
   ```bash
   mkdir ThothAI # o altro nome a vostra scelta
   cd ThothAI
   ```

Una volta entrati nella directory, che farà da root a tutta l'applicazione, clonare da GitHub i progetti del backend (Thoth) e del frontend (ThothSL)

   ```bash
   git clone https://github.com/mptyl/Thoth.git 
   git clone https://github.com/mptyl/ThothUI.git 
   ```

## 2 - Le API Keys
Prima di proseguire con l'installazione, è necessario dotarsi delle API Keys per:

1. ottenere i servizi `LLM` che verranno utilizzati all'interno delle due applicazioni:

    1. **Thoth**, il backend, utilizzerà l'AI generativa per creare le descrizioni mancanti a tabelle e campi 
    2. **ThothUI**, il frontend, la utilizzerà in numerosi passaggi del processo che conduce dall'acquisizione della richiesta sotto forma di testo, alla formulazione di un SQL che, una volta eseguito, estrarrà i dati richiesti dall'utente.

2. ottenere il servizio di logging `Logfire`, che permetterà di verificare il comportamento dell'applicazione in tutte le sue fasi
3. configurare il framework `Django` usato per il backend, per permettere una corretta comunicazione tra backend e frontend
### 2.1 - I servizi di generazione tramite LLM
**ThothAI** è predisposto per potersi collegare ai seguenti fornitori di API LLM:

* OpenAI 
* Gemini (di Google)
* Anthropic 
* Mistral
* DeepSeek
* LMStudio
* Ollama
* OpenRouter (che fa da proxy a centinaia di provider)

Ogni fornitore di API, a sua volta, permette di usare diversi modelli, che andranno specificati nel setup dell'applicazione.

In fase di configurazione occorre stabilire quali provider si desidera utilizzare.  Per ognuno di essi, è necessario procurarsi una API Key.
Se si utilizza Ollama in locale, ovviamente, non è necessaria alcuna API Key, ma solo indicare l'IP del server Ollama utilizzato. 

Per procurarsi l'API Key occorre seguire le procedure previste dal provider.

!!! note "Assegnazione di una API Key"

    Le procedure di assegnazione di una API Key sono più o meno le stesse per ogni fornitore. 
    Creare delle API Key dal nome che volete, come ad esempio ThothKey o simile, per ogni fornitore che si desidera utilizzare. In seguito, si indicherà dove dovranno essere utilizzate.

Se si usa OpenRouter, con una sola API Key si potrà accedere a una lunga lista di LLM, aventi dimensioni e costi molto variabili (alcuni modelli sono resi disponibili addirittura gratuitamente). Andare sul sito di [OpenRouter](https://openrouter.ai/) per ulteriori dettagli. Tramite `OpenRouter` si possono utilizzare modelli di provider non previsti dalla lista precedente, in quanto OpenRouter provvede a esporre sempre la stessa interfaccia, compatibile con OpenAI, utilizzabile per tutti i modelli che supporta.  

I valori di default che sono impostati in Thoth prevedono che tutti gli Agent che svolgono le varie fasi del processo usino LLM forniti da OpenRouter. 

L'utente può ovviamente cambiare questo setup, si vedrà più avanti come, ma, se si vuole provare rapidamente ThothAI, l'ideale è iniziare con l'acquistare 5 o 10 Dollari di servizi OpenRouter e lasciare le impostazioni di default che vengono impostate in fase di installazione. 

Dai nostri test, utilizzando la configurazione di default che prevede un largo uso di modelli economici nelle fasi meno critiche del processo, ogni esecuzione ha un costo variante tra 5 e i 20 centesimi di Dollaro, in funzione del numero di agenti che si vuole attivare in parallelo (più agenti, più probabilità di avere un buon SQL).
Per cui, con una decina di Dollari, si possono fare da 50 a 200 esecuzioni.

### 2.2 - Il servizio Logfire
[Logfire](https://pydantic.dev/logfire) è un servizio messo a disposizione da Pydantic per tracciare l'attività di applicazioni Python. Fino a 10 milioni di messaggi al mese è un servizio gratuito.  

ThothAI produce un log delle sue attività contemporaneamente su console e su Logfire. Il log su Logfire persiste per circa 30 giorni e fornisce un elevato livello di dettaglio sulle operazioni registrate.

Su Logfire non vengono mai inviati dati sul contenuto dei database interrogati, ma se non si vuole utilizzare il servizio basta lasciare vuota la chiave e Logfire non verrà utilizzato. In questo caso rimarranno solo i file di log salvati in locale [(vedi logs)](../3-user_manual/3.4-logging/3.4.2-log_management.md).

Se si vuole usare Logfire è necessario quindi andare su [Logfire](https://pydantic.dev/logfire) e crearsi una API Key. Scegliere un server Europeo per avere migliori performance. Salvare l'URL del server Europeo per le future consultazioni 

!!! note "Il logging di un LLM"

    Loggare le attività effettuate da un LLM è un'attività piuttosto complessa. Con Logfire si può facilmente verificare il testo del prompt ricevuto dal LLM, l'eventuale attivazione di Tools da parte degll'Agent in esecuzione e l'output generato, con abbondanza di dettagli.
    
    Se si vuole controllare al meglio l'azione di ThothAI è opportuno attivare Logfire. Il servizio è attivabile anche in locale, fatte le opportune attività di setup, per cui eventuali problematiche sulla privacy possono essere comunque superate. Per dettagli consultare la documentazione di Logfire 

### 2.3 - Il setup di Django

L'applcazione di backend Thoth è basata su Django, un framework molto utilizzate in ambito Python. Il setup di Django richiede che vengano generate due Key da impostare nel file di configurazione `_env` (per Docker) o `.env` (per l'uso in locale)

#### 2.3.1 - La generazione della Django SECRET_KEY
La SECRET_KEY di Django è una componente fondamentale per la sicurezza dell’applicazione web. Serve principalmente a:

* Fornire firme crittografiche per proteggere dati e sessioni da manomissioni.
* Proteggere contro attacchi CSRF (Cross-Site Request Forgery) generando token unici per ogni sessione utente.
* Firmare e verificare i cookie di sessione, assicurando che i dati di sessione non vengano alterati da terzi.
* Contribuire alla generazione di hash sicuri per le password, aumentando la sicurezza degli account utente.
* Creare firme digitali per autenticare dati come token di autenticazione o parametri URL.

!!! note "La generazione di una SECRET_KEY per Django"

    Per generare una nuova SECRET_KEY Django si può utilizzare il generatore online messo a disposizione da Djecrety all'indirizzo [https://djecrety.ir/](https://djecrety.ir/)



#### 2.3.2 - La generazione della DJANGO_API_KEY
Per generare una chiave API sicura, da usare nella comunicazione tra frontend e backend, utilizzare questo piccolo snippet Python:
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

### 2.4 - La generazione dei file .env e _env
Una volta che si è in possesso delle chiavi degli LLM che si intendono utilizzare, della API KEY di Logfire e delle Key necessarie per lavorare con Django si può procedere con [l'installazione su Docker](../1-install/1.2-docker.md) o con [l'installazione in locale](../1-install/1.3-local.md)
